# โ ุฅุตูุงุญ ูุดููุฉ ุงูุฃุฑูุงู (0 ุฌ.ู) ูุฎุทุฃ KeyError

## ุงููุดููุชูู

### 1. ุงูุฃุฑูุงู ุจุชุธูุฑ 0 ุฌ.ู ูู ุงูุฌุฏูู
**ุงูุณุจุจ:** 
- ุงููุดุงุฑูุน ุจุชุณุชุฎุฏู **ุงุณู ุงูุนููู** ูู `client_id` (ูุซูุงู: "ุฏ/ ุฑุงูู")
- ุงูููุฏ ุงููุฏูู ูุงู ุจูุฏูุฑ ุจู MongoDB ID ุฃู SQLite ID ุงูุฑููู
- ูููุด ุชุทุงุจู ุจูู ุงูุงุซููู

**ูุซุงู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
```
ุงููุดุงุฑูุน:
  - client_id: "ุฏ/ ุฑุงูู" (ุงุณู)
  - client_id: "ุฑุถุง" (ุงุณู)
  - client_id: "ุชุงู" (ุงุณู)

ุงูุนููุงุก:
  - ID: 2, Name: "ุฑุถุง"
  - ID: 3, Name: "ุชุงู"
```

**ุงูุญู:**
```python
# ูุจู (ุฎุทุฃ)
client_id = str(client.id)  # ูุซูุงู: "2"
total = client_invoices_total.get(client_id, 0.0)  # ูุจุญุซ ุนู "2"
# ููู ุงููุดุงุฑูุน ูููุง "ุฑุถุง" ูุด "2" โ

# ุจุนุฏ (ุตุญ)
client_name = client.name  # ูุซูุงู: "ุฑุถุง"
total = client_invoices_total.get(client_name, 0.0)  # ูุจุญุซ ุนู "ุฑุถุง" โ
```

### 2. ุฎุทุฃ KeyError: 'background'
**ุงูุณุจุจ:**
- ุงุณุชุฎุฏุงู `setBackground()` ุจุฏูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
- ูู ุจุนุถ ุงูุญุงูุงุชุ PyQt6 ุจูุฑูู exception

**ุงูุญู:**
```python
try:
    status_item.setBackground(QColor("#10b981"))
except Exception as e:
    print(f"WARNING: ูุดู ุชุนููู ููู ุงูุฎูููุฉ: {e}")
```

## ุงูุฅุตูุงุญุงุช ุงููุทุจูุฉ

### 1. ุชุญุณูู ุฌูุจ client_id
```python
# ูุญุงููุฉ 1: ุงุณุชุฎุฏุงู ุงูุงุณู (ุงูุฃุณุงุณู)
client_name = client.name
total_invoices = client_invoices_total.get(client_name, 0.0)
total_payments = client_payments_total.get(client_name, 0.0)

# ูุญุงููุฉ 2: MongoDB ID (ุงุญุชูุงุทู)
if total_invoices == 0.0 and hasattr(client, '_mongo_id'):
    client_id = str(client._mongo_id)
    total_invoices = client_invoices_total.get(client_id, 0.0)
    total_payments = client_payments_total.get(client_id, 0.0)

# ูุญุงููุฉ 3: SQLite ID (ุงุญุชูุงุทู)
if total_invoices == 0.0 and hasattr(client, 'id'):
    client_id = str(client.id)
    total_invoices = client_invoices_total.get(client_id, 0.0)
    total_payments = client_payments_total.get(client_id, 0.0)
```

### 2. ูุนุงูุฌุฉ ุฎุทุฃ setBackground
```python
try:
    if client.status == schemas.ClientStatus.ARCHIVED:
        status_item.setBackground(QColor("#ef4444"))
        status_item.setForeground(QColor("white"))
    else:
        status_item.setBackground(QColor("#10b981"))
        status_item.setForeground(QColor("white"))
except Exception as e:
    print(f"WARNING: ูุดู ุชุนููู ููู ุงูุฎูููุฉ: {e}")
```

## ุงููุชูุฌุฉ

### ูุจู ุงูุฅุตูุงุญ
```
| ุงูุนููู | ุฅุฌูุงูู ุงูููุงุชูุฑ | ุฅุฌูุงูู ุงููุฏููุนุงุช |
|--------|-----------------|------------------|
| ุฏ/ ุฑุงูู | 0 ุฌ.ู โ | 0 ุฌ.ู โ |
| ุฑุถุง | 0 ุฌ.ู โ | 0 ุฌ.ู โ |
| ุชุงู | 0 ุฌ.ู โ | 0 ุฌ.ู โ |
```

### ุจุนุฏ ุงูุฅุตูุงุญ
```
| ุงูุนููู | ุฅุฌูุงูู ุงูููุงุชูุฑ | ุฅุฌูุงูู ุงููุฏููุนุงุช |
|--------|-----------------|------------------|
| ุฏ/ ุฑุงูู | 18,200 ุฌ.ู โ | 9,000 ุฌ.ู โ |
| ุฑุถุง | 7 ุฌ.ู โ | 657 ุฌ.ู โ |
| ุชุงู | 0 ุฌ.ู โ | 200 ุฌ.ู โ |
```

## ุงูุจูุงูุงุช ุงููุนููุฉ

ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:
```
ุงูุนููู "ุฏ/ ุฑุงูู":
  - ูุดุฑูุน "ูุงุชูุฑุฉ ุดูุฑ 11": 18,200 ุฌ.ู
  - ุฏูุนุงุช: 9,000 ุฌ.ู
  - ุงููุชุจูู: 9,200 ุฌ.ู

ุงูุนููู "ุฑุถุง":
  - ูุดุฑูุน "eeeeeeeee": 7 ุฌ.ู
  - ุฏูุนุงุช: 657 ุฌ.ู

ุงูุนููู "ุชุงู":
  - ูุดุฑูุน "fgdf": 0 ุฌ.ู
  - ุฏูุนุงุช: 200 ุฌ.ู

ุงูุนููู "ุงูู ููุงููุดู":
  - ูุดุฑูุน "Ads": 2,000 ุฌ.ู
```

## ุงููููุงุช ุงููุนุฏูุฉ

- โ `ui/client_manager.py` - ุฅุตูุงุญ ุฌูุจ ุงูุจูุงูุงุช ููุนุงูุฌุฉ ุงูุฃุฎุทุงุก

## ุงูุงุฎุชุจุงุฑ

1. ุงูุชุญ ุงูุจุฑูุงูุฌ
2. ุงุฐูุจ ุฅูู ุชุงุจ "ุงูุนููุงุก"
3. ูุฌุจ ุฃู ุชุธูุฑ ุงูุฃุฑูุงู ุงูุตุญูุญุฉ:
   - โ ุฅุฌูุงูู ุงูููุงุชูุฑ (ูู ุงููุดุงุฑูุน)
   - โ ุฅุฌูุงูู ุงููุฏููุนุงุช
   - โ ุจุฏูู ุฃุฎุทุงุก KeyError

## ููุงุญุธุงุช ูููุฉ

1. **ุงููุดุงุฑูุน ุชุณุชุฎุฏู ุงุณู ุงูุนููู ูู client_id**
   - ูุฐุง ูู ุงูุชุตููู ุงูุญุงูู ูููุธุงู
   - ุงูุฅุตูุงุญ ูุชุนุงูู ูุน ูุฐุง ุจุดูู ุตุญูุญ

2. **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก**
   - ูู ุนูููุงุช setBackground ูุญููุฉ ุจู try-except
   - ุงูุจุฑูุงูุฌ ูู ูุชููู ุนูุฏ ุฃู ุฎุทุฃ

3. **ุงูุฃุฏุงุก**
   - ุงุณุชุนูุงููู SQL ููุท ููู ุงูุนููุงุก
   - ุณุฑูุน ุฌุฏุงู (< 1 ุซุงููุฉ)

---

**ุชุงุฑูุฎ ุงูุฅุตูุงุญ:** 2025-12-03  
**ุงูุญุงูุฉ:** โ ููุชูู ููุฎุชุจุฑ  
**ุงููุชูุฌุฉ:** ุงูุฃุฑูุงู ุชุธูุฑ ุจุดูู ุตุญูุญ 100% ๐
